<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIFAS LOMA - ¬°Gana $5,000! üçÄ</title>
    <style>
        :root { --primary: #1e40af; --gold: #fbbf24; --success: #22c55e; --danger: #ef4444; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; margin: 0; padding: 0; text-align: center; color: #1e293b; transition: padding-bottom 0.3s; }
        
        .header { background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); color: white; padding: 40px 15px; border-bottom: 5px solid var(--gold); }
        .header h1 { margin: 0; font-size: 35px; letter-spacing: 3px; text-shadow: 2px 2px #000; }
        
        .premio-grande { font-size: 50px; font-weight: 900; color: var(--gold); margin: 15px 0; text-shadow: 0 0 15px rgba(251, 191, 36, 0.6); display: inline-block; animation: pulse-suave 2s infinite ease-in-out; }
        @keyframes pulse-suave { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        .container { max-width: 600px; margin: -20px auto 20px; background: white; padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); position: relative; }
        
        .tools-section { background: #f8fafc; padding: 20px; border-radius: 20px; border: 1px solid #e2e8f0; margin-bottom: 25px; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        
        .azar-control { display: flex; gap: 10px; align-items: center; justify-content: center; flex-wrap: wrap; }
        .azar-control input { width: 80px; padding: 10px; border-radius: 10px; border: 2px solid #cbd5e1; text-align: center; font-size: 16px; font-weight: bold; }
        .btn-azar-go { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }

        .grid-numeros { display: grid; grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); gap: 12px; max-height: 400px; overflow-y: auto; padding: 15px; background: #fff; border-radius: 15px; border: 1px solid #cbd5e1; scroll-behavior: smooth; }
        
        .boleto { padding: 15px 5px; background: white; border: 1px solid #cbd5e1; border-radius: 12px; cursor: pointer; transition: 0.2s; }
        .seleccionado { background: var(--primary) !important; border-color: var(--primary); color: white !important; box-shadow: 0 0 10px var(--primary); }
        .vendido { background: #e2e8f0 !important; color: #94a3b8 !important; text-decoration: line-through; opacity: 0.5; cursor: not-allowed; }

        .controles-flotantes { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 540px; display: none; flex-direction: column; gap: 10px; z-index: 999; }
        .btn-apartar-fijo { background: var(--success); color: white; border: none; padding: 18px; border-radius: 15px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4); flex: 1; }
        .btn-limpiar-todo { background: var(--danger); color: white; border: none; padding: 10px; border-radius: 12px; font-size: 14px; font-weight: bold; cursor: pointer; opacity: 0.9; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px); }
        .modal-content { background: white; margin: 15% auto; padding: 25px; border-radius: 20px; width: 85%; max-width: 400px; text-align: center; }
        
        .tag-numero { display: inline-flex; align-items: center; background: #e0e7ff; color: #1e40af; padding: 5px 10px; border-radius: 8px; margin: 4px; font-weight: bold; border: 1px solid #c7d2fe; }
        .btn-del { margin-left: 8px; color: var(--danger); cursor: pointer; font-size: 16px; border: none; background: none; font-weight: 900; }
        
        .footer { padding: 20px 20px 120px; font-size: 14px; color: #64748b; line-height: 1.6; }
        .legal-notice { background: #f1f5f9; padding: 10px; border-radius: 10px; margin-top: 10px; font-weight: bold; color: #475569; border: 1px dashed #cbd5e1; }
    </style>
</head>
<body>

<div class="header">
    <h1>‚ú® RIFAS LOMA ‚ú®</h1>
    <div class="premio-grande">üí∞ $5,000 MXN üí∞</div><br>
    <div class="badge-precio" style="background:var(--success); color:white; padding:10px 25px; border-radius:50px; font-weight:bold; display:inline-block; margin-top:10px;">üçÄ ¬°Cada n√∫mero por solo $10! üçÄ</div>
</div>

<div class="container">
    <div class="tools-section">
        <div style="font-weight: bold; color: var(--primary);">üé≤ ¬øCu√°ntos n√∫meros al azar quieres?</div>
        <div class="azar-control">
            <input type="number" id="cantidadAzar" placeholder="Ej: 5" min="1">
            <button class="btn-azar-go" onclick="generarAzar()">¬°Probar suerte!</button>
        </div>
    </div>
    <div class="grid-numeros" id="tablero">Cargando n√∫meros...</div>
</div>

<div class="footer">
    üìç <b>Tonal√°, Jalisco.</b><br>
    Sorteo basado en las √∫ltimas 3 cifras del Premio Mayor de la <b>Loter√≠a Nacional</b>.<br>
    <div class="legal-notice">‚öñÔ∏è Sorteo realizado de forma transparente y totalmente legal.</div>
</div>

<div id="controlesFlotantes" class="controles-flotantes">
    <button class="btn-limpiar-todo" onclick="limpiarTodo()">üóëÔ∏è Borrar toda la selecci√≥n</button>
    <button class="btn-apartar-fijo" onclick="abrirModalFinal()">‚úÖ APARTAR (<span id="cantidadLabel">0</span>)</button>
</div>

<div id="modalFinal" class="modal">
    <div class="modal-content" style="text-align: left;">
        <h2>üìù Confirmar Apartado</h2>
        <div style="max-height: 150px; overflow-y: auto; background: #f8fafc; padding: 10px; border-radius: 10px; margin-bottom: 15px;" id="resumenFinal"></div>
        <input type="text" id="nombreCliente" placeholder="Nombre Completo" style="width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:10px; box-sizing:border-box;">
        <input type="tel" id="telCliente" placeholder="WhatsApp (10 d√≠gitos)" style="width:100%; padding:12px; margin:8px 0; border:1px solid #ddd; border-radius:10px; box-sizing:border-box;">
        <button style="background:var(--success); color:white; border:none; padding:15px; width:100%; border-radius:12px; font-size:18px; font-weight:bold; cursor:pointer;" onclick="finalizarCompra()">‚úÖ ENVIAR POR WHATSAPP</button>
        <button style="background:none; border:none; color:gray; width:100%; margin-top:10px; cursor:pointer" onclick="cerrarModalFinal()">Regresar</button>
    </div>
</div>

<script>
    const WHATSAPP_CEL = "523321550408";
    const URL_EXCEL_PAGADOS = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTunKPG1TATOAhqerk253nBPufFK_qGmOqMc8bZpIkTJZcoKdZ66wwFByyWnQeo2ju4V9ECUv8aM2vi/pub?output=csv';

    let seleccionados = [];
    let pagados = [];

    async function cargarPagados() {
        try {
            const res = await fetch(URL_EXCEL_PAGADOS + '&t=' + Math.random());
            const csv = await res.text();
            pagados = csv.split(/\r?\n/).map(l => l.split(',')[0].trim()).filter(n => n !== "" && !isNaN(n)).map(n => n.padStart(3, '0'));
            generarTablero();
        } catch (e) { generarTablero(); }
    }

    function generarTablero() {
        const tablero = document.getElementById('tablero');
        tablero.innerHTML = "";
        for (let i = 0; i <= 999; i++) {
            let n = i.toString().padStart(3, '0');
            let div = document.createElement('div');
            div.className = 'boleto';
            div.id = "b-" + n;
            div.innerHTML = `<span class="n-principal">${n}</span>`;
            if (pagados.includes(n)) div.classList.add('vendido');
            else div.onclick = () => toggleSeleccion(n);
            tablero.appendChild(div);
        }
    }

    function toggleSeleccion(n) {
        if (seleccionados.includes(n)) {
            seleccionados = seleccionados.filter(item => item !== n);
            document.getElementById("b-" + n).classList.remove('seleccionado');
        } else {
            seleccionados.push(n);
            document.getElementById("b-" + n).classList.add('seleccionado');
        }
        actualizarUI();
    }

    function generarAzar() {
        const cant = parseInt(document.getElementById('cantidadAzar').value);
        if (isNaN(cant) || cant <= 0) return;
        let disponibles = [];
        for(let i=0; i<=999; i++) {
            let n = i.toString().padStart(3, '0');
            if(!pagados.includes(n) && !seleccionados.includes(n)) disponibles.push(n);
        }
        for(let i=0; i<cant; i++) {
            if (disponibles.length === 0) break;
            let index = Math.floor(Math.random() * disponibles.length);
            let n = disponibles[index];
            seleccionados.push(n);
            document.getElementById("b-" + n).classList.add('seleccionado');
            disponibles.splice(index, 1);
        }
        actualizarUI();
        abrirModalFinal();
    }

    function limpiarTodo() {
        if(!confirm("¬øBorrar todos los n√∫meros elegidos?")) return;
        seleccionados.forEach(n => document.getElementById("b-" + n).classList.remove('seleccionado'));
        seleccionados = [];
        actualizarUI();
    }

    function quitarUno(n) {
        seleccionados = seleccionados.filter(item => item !== n);
        const el = document.getElementById("b-" + n);
        if(el) el.classList.remove('seleccionado');
        actualizarUI();
        renderResumen();
        if(seleccionados.length === 0) cerrarModalFinal();
    }

    function actualizarUI() {
        const cont = document.getElementById('controlesFlotantes');
        document.getElementById('cantidadLabel').innerText = seleccionados.length;
        cont.style.display = seleccionados.length > 0 ? 'flex' : 'none';
        document.body.style.paddingBottom = seleccionados.length > 0 ? "150px" : "0px";
    }

    function renderResumen() {
        document.getElementById('resumenFinal').innerHTML = seleccionados.map(n => `
            <span class="tag-numero">
                ${n} <button class="btn-del" onclick="quitarUno('${n}')">√ó</button>
            </span>
        `).join('');
    }

    function abrirModalFinal() { 
        renderResumen();
        document.getElementById('modalFinal').style.display = 'block'; 
    }
    function cerrarModalFinal() { document.getElementById('modalFinal').style.display = 'none'; }

    function finalizarCompra() {
        const nombre = document.getElementById('nombreCliente').value;
        const tel = document.getElementById('telCliente').value;
        if(!nombre || !tel) { alert("Llena tus datos"); return; }
        
        // DATOS DE PAGO INCLUIDOS AQU√ç
        let total = seleccionados.length * 10;
        let mensaje = `*RIFAS LOMA üçÄ*%0A*CLIENTE:* ${nombre}%0A%0A‚úÖ *MIS N√öMEROS:*%0A${seleccionados.join(', ')}%0A%0Aüí∞ *TOTAL A PAGAR:* $${total} MXN%0A%0A---%0Aüè¶ *DATOS DE PAGO (BBVA):*%0A*Beneficiario:* Christian Alejandro Reyna Huerta%0A*Cuenta:* 4152314129681402%0A*CLABE:* 012 180 01529748649 5%0A%0A‚ö†Ô∏è *IMPORTANTE:* Por favor, env√≠a tu comprobante de pago por aqu√≠ para confirmar tu participaci√≥n.`;
        
        window.open(`https://wa.me/${WHATSAPP_CEL}?text=${mensaje}`, '_blank');
        cerrarModalFinal();
    }

    cargarPagados();
</script>
</body>
</html>
